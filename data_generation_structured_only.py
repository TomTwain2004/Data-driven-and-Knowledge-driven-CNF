import csv
import time
import numpy as np

root_path = '/home/resadmin/haoran/BiLSTM/'
data_id = {}
data_record = {}
# read id with label yes or no
i = 0
id_set = []

drop_patient = 0
start_time = time.time()

# load pharmacy records

pharmacy_records = {}
with open(root_path + 'data_20220603_1304/processed_encounter_pharmacy_digital_20220603.csv', newline='') as csvfile:
    spamreader = csv.reader(csvfile, delimiter=',')
    for i, row in enumerate(spamreader):
        if i == 0:
            print(row)
            pharmacy_features_len = len(row[1:])
            print(pharmacy_features_len)  # 1029=294, 1105=293; 20220523=282
        if not row:
            continue
        pharmacy_records[row[0]] = row[1:]

        """(294)1029 = ['id', 'A00-A09', 'A15-A19', 'A20-A28', 'A30-A49', 'A50-A64', 'A65-A69', 'ADHD/ANTI-NARCOLEPSY/ANTI-OBESITY/ANOREXIANTS', 'ALTERNATIVE MEDICINES', 'ANALGESICS - ANTI-INFLAMMATORY', 'ANALGESICS - NonNarcotic', 'ANALGESICS - OPIOID', 'ANDROGENS-ANABOLIC', 'ANORECTAL AND RELATED PRODUCTS', 'ANTACIDS', 'ANTHELMINTICS', 'ANTI-INFECTIVE AGENTS', 'ANTI-INFECTIVE AGENTS - MISC.', 'ANTIANGINAL AGENTS', 'ANTIANXIETY AGENTS', 'ANTIARRHYTHMICS', 'ANTIASTHMATIC AND BRONCHODILATOR AGENTS', 'ANTICOAGULANTS', 'ANTICONVULSANTS', 'ANTIDEPRESSANTS', 'ANTIDIABETICS', 'ANTIDIARRHEAL/PROBIOTIC AGENTS', 'ANTIDOTES AND SPECIFIC ANTAGONISTS', 'ANTIEMETICS', 'ANTIFUNGALS', 'ANTIHISTAMINES', 'ANTIHYPERLIPIDEMICS', 'ANTIHYPERTENSIVES', 'ANTIMALARIALS', 'ANTIMYCOBACTERIAL AGENTS', 'ANTINEOPLASTICS AND ADJUNCTIVE THERAPIES', 'ANTIPARKINSON AND RELATED THERAPY AGENTS', 'ANTIPSYCHOTICS/ANTIMANIC AGENTS', 'ANTISEPTICS & DISINFECTANTS', 'ANTIVIRALS', 'B00-B09', 'B10-B10', 'B15-B19', 'B20-B20', 'B25-B34', 'B35-B49', 'B85-B89', 'B95-B97', 'B99-B99', 'BETA BLOCKERS', 'BMI', 'C00-D49', 'C44-C44', 'CALCIUM CHANNEL BLOCKERS', 'CARDIOTONICS', 'CARDIOVASCULAR AGENTS - MISC.', 'CEPHALOSPORINS', 'CHEMICALS', 'CONTRACEPTIVES', 'CORTICOSTEROIDS', 'COUGH/COLD/ALLERGY', 'D50-D53', 'D55-D59', 'D60-D64', 'D65-D69', 'D70-D77', 'D80-D89', 'DERMATOLOGICALS', 'DIETARY PRODUCTS/DIETARY MANAGEMENT PRODUCTS', 'DIGESTIVE AIDS', 'DIURETICS', 'E00-E07', 'E08-E13', 'E15-E16', 'E20-E35', 'E40-E46', 'E50-E64', 'E65-E68', 'E70-E88', 'E89-E89', 'ENDOCRINE AND METABOLIC AGENTS - MISC.', 'ESTROGENS', 'F01-F09', 'F10-F19', 'F20-F29', 'F30-F39', 'F40-F48', 'F50-F59', 'F60-F69', 'F70-F79', 'F80-F89', 'F90-F98', 'F99-F99', 'G10-G14', 'G20-G26', 'G30-G32', 'G35-G37', 'G40-G47', 'G50-G59', 'G60-G65', 'G70-G73', 'G80-G83', 'G89-G99', 'GASTROINTESTINAL AGENTS - MISC.', 'GENITOURINARY AGENTS - MISCELLANEOUS', 'GOUT AGENTS', 'H00-H05', 'H10-H11', 'H15-H22', 'H25-H28', 'H30-H36', 'H40-H42', 'H43-H44', 'H46-H47', 'H49-H52', 'H53-H54', 'H55-H57', 'H60-H62', 'H65-H75', 'H80-H83', 'H90-H94', 'HEMATOLOGICAL AGENTS - MISC.', 'HEMATOPOIETIC AGENTS', 'HEMOSTATICS', 'HYPNOTICS/SEDATIVES/SLEEP DISORDER AGENTS', 'I00-I02', 'I05-I09', 'I10-I16', 'I20-I25', 'I26-I28', 'I30-I52', 'I60-I69', 'I70-I79', 'I80-I89', 'I95-I99', 'J00-J06', 'J09-J18', 'J20-J22', 'J30-J39', 'J40-J47', 'J60-J70', 'J80-J84', 'J85-J86', 'J90-J94', 'J95-J95', 'J96-J99', 'K00-K14', 'K20-K31', 'K35-K38', 'K40-K46', 'K50-K52', 'K55-K64', 'K65-K68', 'K70-K77', 'K80-K87', 'K90-K95', 'L00-L08', 'L10-L14', 'L20-L30', 'L40-L45', 'L49-L54', 'L55-L59', 'L60-L75', 'L76-L76', 'L80-L99', 'LAXATIVES', 'M00-M02', 'M05-M14', 'M15-M19', 'M1A', 'M20-M25', 'M26-M27', 'M30-M36', 'M40-M43', 'M45-M49', 'M50-M54', 'M60-M63', 'M65-M67', 'M70-M79', 'M80-M85', 'M86-M90', 'M91-M94', 'M96-M96', 'M97-M97', 'M99-M99', 'MIGRAINE PRODUCTS', 'MINERALS & ELECTROLYTES', 'MISCELLANEOUS THERAPEUTIC CLASSES', 'MOUTH/THROAT/DENTAL AGENTS', 'MULTIVITAMINS', 'MUSCULOSKELETAL THERAPY AGENTS', 'N00-N08', 'N10-N16', 'N17-N19', 'N20-N23', 'N25-N29', 'N30-N39', 'N40-N53', 'N60-N65', 'N70-N77', 'N80-N98', 'N99-N99', 'NASAL AGENTS - SYSTEMIC AND TOPICAL', 'NEUROMUSCULAR AGENTS', 'OPHTHALMIC AGENTS', 'OTIC AGENTS', 'P05-P08', 'P19-P29', 'PROGESTINS', 'PSYCHOTHERAPEUTIC AND NEUROLOGICAL AGENTS - MISC.', 'Q00-Q07', 'Q10-Q18', 'Q20-Q28', 'Q38-Q45', 'Q50-Q56', 'Q60-Q64', 'Q65-Q79', 'Q80-Q89', 'Q90-Q99', 'R00-R09', 'R10-R19', 'R20-R23', 'R25-R29', 'R30-R39', 'R40-R46', 'R47-R49', 'R50-R69', 'R70-R79', 'R80-R82', 'R83-R89', 'R90-R94', 'R97-R97', 'RESPIRATORY AGENTS - MISC.', 'S00-S09', 'S10-S19', 'S20-S29', 'S30-S39', 'S40-S49', 'S50-S59', 'S60-S69', 'S70-S79', 'S80-S89', 'S90-S99', 'T07-T07', 'T14-T14', 'T15-T19', 'T20-T25', 'T30-T32', 'T36-T50', 'T51-T65', 'T66-T78', 'T79-T79', 'T80-T88', 'THYROID AGENTS', 'TOXOIDS', 'U00-U49', 'ULCER DRUGS/ANTISPASMODICS/ANTICHOLINERGICS', 'URINARY ANTI-INFECTIVES', 'URINARY ANTISPASMODICS', 'V00-V09', 'V10-V19', 'V20-V29', 'V40-V49', 'V50-V59', 'V80-V89', 'V98-V99', 'VACCINES', 'VAGINAL AND RELATED PRODUCTS', 'VASOPRESSORS', 'VITAMINS', 'W00-W19', 'W20-W49', 'W50-W64', 'X10-X19', 'X50-X50', 'X52-X58', 'X92-X99', 'Y00-Y09', 'Y70-Y82', 'Y83-Y84', 'Y90-Y99', 'Z00-Z13', 'Z14-Z15', 'Z16-Z16', 'Z17-Z17', 'Z19-Z19', 'Z20-Z29', 'Z30-Z39', 'Z3A', 'Z40-Z53', 'Z55-Z65', 'Z66-Z66', 'Z67-Z67', 'Z69-Z76', 'Z77-Z99']"""
        """(293)1105 = ['id', 'A00-A09', 'A15-A19', 'A20-A28', 'A30-A49', 'A50-A64', 'A65-A69', 'ADHD/ANTI-NARCOLEPSY/ANTI-OBESITY/ANOREXIANTS', 'ALTERNATIVE MEDICINES', 'ANALGESICS - ANTI-INFLAMMATORY', 'ANALGESICS - NonNarcotic', 'ANALGESICS - OPIOID', 'ANDROGENS-ANABOLIC', 'ANORECTAL AND RELATED PRODUCTS', 'ANTACIDS', 'ANTHELMINTICS', 'ANTI-INFECTIVE AGENTS', 'ANTI-INFECTIVE AGENTS - MISC.', 'ANTIANGINAL AGENTS', 'ANTIANXIETY AGENTS', 'ANTIARRHYTHMICS', 'ANTIASTHMATIC AND BRONCHODILATOR AGENTS', 'ANTICOAGULANTS', 'ANTICONVULSANTS', 'ANTIDEPRESSANTS', 'ANTIDIABETICS', 'ANTIDIARRHEAL/PROBIOTIC AGENTS', 'ANTIDOTES AND SPECIFIC ANTAGONISTS', 'ANTIEMETICS', 'ANTIFUNGALS', 'ANTIHISTAMINES', 'ANTIHYPERLIPIDEMICS', 'ANTIHYPERTENSIVES', 'ANTIMALARIALS', 'ANTIMYCOBACTERIAL AGENTS', 'ANTINEOPLASTICS AND ADJUNCTIVE THERAPIES', 'ANTIPARKINSON AND RELATED THERAPY AGENTS', 'ANTIPSYCHOTICS/ANTIMANIC AGENTS', 'ANTISEPTICS & DISINFECTANTS', 'ANTIVIRALS', 'B00-B09', 'B10-B10', 'B15-B19', 'B20-B20', 'B25-B34', 'B35-B49', 'B85-B89', 'B95-B97', 'B99-B99', 'BETA BLOCKERS', 'BMI', 'C00-D49', 'C44-C44', 'CALCIUM CHANNEL BLOCKERS', 'CARDIOTONICS', 'CARDIOVASCULAR AGENTS - MISC.', 'CEPHALOSPORINS', 'CHEMICALS', 'CONTRACEPTIVES', 'CORTICOSTEROIDS', 'COUGH/COLD/ALLERGY', 'D50-D53', 'D55-D59', 'D60-D64', 'D65-D69', 'D70-D77', 'D80-D89', 'DERMATOLOGICALS', 'DIETARY PRODUCTS/DIETARY MANAGEMENT PRODUCTS', 'DIGESTIVE AIDS', 'DIURETICS', 'E00-E07', 'E08-E13', 'E15-E16', 'E20-E35', 'E40-E46', 'E50-E64', 'E65-E68', 'E70-E88', 'E89-E89', 'ENDOCRINE AND METABOLIC AGENTS - MISC.', 'ESTROGENS', 'F01-F09', 'F10-F19', 'F20-F29', 'F30-F39', 'F40-F48', 'F50-F59', 'F60-F69', 'F70-F79', 'F80-F89', 'F90-F98', 'F99-F99', 'G10-G14', 'G20-G26', 'G30-G32', 'G35-G37', 'G40-G47', 'G50-G59', 'G60-G65', 'G70-G73', 'G80-G83', 'G89-G99', 'GASTROINTESTINAL AGENTS - MISC.', 'GENITOURINARY AGENTS - MISCELLANEOUS', 'GOUT AGENTS', 'H00-H05', 'H10-H11', 'H15-H22', 'H25-H28', 'H30-H36', 'H40-H42', 'H43-H44', 'H46-H47', 'H49-H52', 'H53-H54', 'H55-H57', 'H60-H62', 'H65-H75', 'H80-H83', 'H90-H94', 'HEMATOLOGICAL AGENTS - MISC.', 'HEMATOPOIETIC AGENTS', 'HEMOSTATICS', 'HYPNOTICS/SEDATIVES/SLEEP DISORDER AGENTS', 'I00-I02', 'I05-I09', 'I10-I16', 'I20-I25', 'I26-I28', 'I30-I52', 'I60-I69', 'I70-I79', 'I80-I89', 'I95-I99', 'J00-J06', 'J09-J18', 'J20-J22', 'J30-J39', 'J40-J47', 'J60-J70', 'J80-J84', 'J85-J86', 'J90-J94', 'J95-J95', 'J96-J99', 'K00-K14', 'K20-K31', 'K35-K38', 'K40-K46', 'K50-K52', 'K55-K64', 'K65-K68', 'K70-K77', 'K80-K87', 'K90-K95', 'L00-L08', 'L10-L14', 'L20-L30', 'L40-L45', 'L49-L54', 'L55-L59', 'L60-L75', 'L76-L76', 'L80-L99', 'LAXATIVES', 'M00-M02', 'M05-M14', 'M15-M19', 'M1A', 'M20-M25', 'M26-M27', 'M30-M36', 'M40-M43', 'M45-M49', 'M50-M54', 'M60-M63', 'M65-M67', 'M70-M79', 'M80-M85', 'M86-M90', 'M91-M94', 'M96-M96', 'M97-M97', 'M99-M99', 'MIGRAINE PRODUCTS', 'MINERALS & ELECTROLYTES', 'MISCELLANEOUS THERAPEUTIC CLASSES', 'MOUTH/THROAT/DENTAL AGENTS', 'MULTIVITAMINS', 'MUSCULOSKELETAL THERAPY AGENTS', 'N00-N08', 'N10-N16', 'N17-N19', 'N20-N23', 'N25-N29', 'N30-N39', 'N40-N53', 'N60-N65', 'N70-N77', 'N80-N98', 'N99-N99', 'NASAL AGENTS - SYSTEMIC AND TOPICAL', 'NEUROMUSCULAR AGENTS', 'OPHTHALMIC AGENTS', 'OTIC AGENTS', 'P05-P08', 'P19-P29', 'PROGESTINS', 'PSYCHOTHERAPEUTIC AND NEUROLOGICAL AGENTS - MISC.', 'Q00-Q07', 'Q10-Q18', 'Q20-Q28', 'Q38-Q45', 'Q50-Q56', 'Q60-Q64', 'Q65-Q79', 'Q80-Q89', 'Q90-Q99', 'R00-R09', 'R10-R19', 'R20-R23', 'R25-R29', 'R30-R39', 'R40-R46', 'R47-R49', 'R50-R69', 'R70-R79', 'R80-R82', 'R83-R89', 'R90-R94', 'R97-R97', 'RESPIRATORY AGENTS - MISC.', 'S00-S09', 'S10-S19', 'S20-S29', 'S30-S39', 'S40-S49', 'S50-S59', 'S60-S69', 'S70-S79', 'S80-S89', 'S90-S99', 'T07-T07', 'T14-T14', 'T15-T19', 'T20-T25', 'T30-T32', 'T36-T50', 'T51-T65', 'T66-T78', 'T79-T79', 'T80-T88', 'THYROID AGENTS', 'TOXOIDS', 'U00-U49', 'ULCER DRUGS/ANTISPASMODICS/ANTICHOLINERGICS', 'URINARY ANTI-INFECTIVES', 'URINARY ANTISPASMODICS', 'V00-V09', 'V10-V19', 'V20-V29', 'V40-V49', 'V50-V59', 'V80-V89', 'V98-V99', 'VACCINES', 'VAGINAL AND RELATED PRODUCTS', 'VASOPRESSORS', 'VITAMINS', 'W00-W19', 'W20-W49', 'W50-W64', 'X10-X19', 'X50-X50', 'X52-X58', 'X92-X99', 'Y00-Y09', 'Y70-Y82', 'Y83-Y84', 'Y90-Y99', 'Z00-Z13', 'Z14-Z15', 'Z16-Z16', 'Z17-Z17', 'Z19-Z19', 'Z20-Z29', 'Z30-Z39', 'Z3A', 'Z55-Z65', 'Z66-Z66', 'Z67-Z67', 'Z69-Z76', 'Z77-Z99']"""
        """(284)1119 = ['id', 'A00-A09', 'A15-A19', 'A20-A28', 'A30-A49', 'A50-A64', 'A65-A69', 'ADHD/ANTI-NARCOLEPSY/ANTI-OBESITY/ANOREXIANTS', 'ALTERNATIVE MEDICINES', 'ANALGESICS - ANTI-INFLAMMATORY', 'ANALGESICS - NonNarcotic', 'ANALGESICS - OPIOID', 'ANDROGENS-ANABOLIC', 'ANORECTAL AND RELATED PRODUCTS', 'ANTACIDS', 'ANTHELMINTICS', 'ANTI-INFECTIVE AGENTS', 'ANTI-INFECTIVE AGENTS - MISC.', 'ANTIANGINAL AGENTS', 'ANTIANXIETY AGENTS', 'ANTIARRHYTHMICS', 'ANTIASTHMATIC AND BRONCHODILATOR AGENTS', 'ANTICOAGULANTS', 'ANTICONVULSANTS', 'ANTIDEPRESSANTS', 'ANTIDIABETICS', 'ANTIDIARRHEAL/PROBIOTIC AGENTS', 'ANTIDOTES AND SPECIFIC ANTAGONISTS', 'ANTIEMETICS', 'ANTIFUNGALS', 'ANTIHISTAMINES', 'ANTIHYPERLIPIDEMICS', 'ANTIHYPERTENSIVES', 'ANTIMALARIALS', 'ANTIMYCOBACTERIAL AGENTS', 'ANTINEOPLASTICS AND ADJUNCTIVE THERAPIES', 'ANTIPARKINSON AND RELATED THERAPY AGENTS', 'ANTIPSYCHOTICS/ANTIMANIC AGENTS', 'ANTISEPTICS & DISINFECTANTS', 'ANTIVIRALS', 'B00-B09', 'B10-B10', 'B15-B19', 'B20-B20', 'B25-B34', 'B35-B49', 'B85-B89', 'B95-B97', 'B99-B99', 'BETA BLOCKERS', 'BMI', 'C00-D49', 'C44-C44', 'CALCIUM CHANNEL BLOCKERS', 'CARDIOTONICS', 'CARDIOVASCULAR AGENTS - MISC.', 'CEPHALOSPORINS', 'CHEMICALS', 'CONTRACEPTIVES', 'CORTICOSTEROIDS', 'COUGH/COLD/ALLERGY', 'D50-D53', 'D55-D59', 'D60-D64', 'D65-D69', 'D70-D77', 'D80-D89', 'DIETARY PRODUCTS/DIETARY MANAGEMENT PRODUCTS', 'DIGESTIVE AIDS', 'DIURETICS', 'E00-E07', 'E08-E13', 'E15-E16', 'E20-E35', 'E40-E46', 'E50-E64', 'E65-E68', 'E70-E88', 'E89-E89', 'ENDOCRINE AND METABOLIC AGENTS - MISC.', 'ESTROGENS', 'F01-F09', 'F10-F19', 'F20-F29', 'F30-F39', 'F40-F48', 'F50-F59', 'F60-F69', 'F70-F79', 'F80-F89', 'F90-F98', 'F99-F99', 'G10-G14', 'G20-G26', 'G30-G32', 'G35-G37', 'G40-G47', 'G50-G59', 'G60-G65', 'G70-G73', 'G80-G83', 'G89-G99', 'GASTROINTESTINAL AGENTS - MISC.', 'GENITOURINARY AGENTS - MISCELLANEOUS', 'GOUT AGENTS', 'H10-H11', 'H15-H22', 'H30-H36', 'H40-H42', 'H43-H44', 'H46-H47', 'H49-H52', 'H53-H54', 'H55-H57', 'H60-H62', 'H65-H75', 'H80-H83', 'H90-H94', 'HEMATOLOGICAL AGENTS - MISC.', 'HEMATOPOIETIC AGENTS', 'HEMOSTATICS', 'HYPNOTICS/SEDATIVES/SLEEP DISORDER AGENTS', 'I00-I02', 'I05-I09', 'I10-I16', 'I20-I25', 'I26-I28', 'I30-I52', 'I60-I69', 'I70-I79', 'I80-I89', 'I95-I99', 'J00-J06', 'J09-J18', 'J20-J22', 'J30-J39', 'J40-J47', 'J60-J70', 'J80-J84', 'J85-J86', 'J90-J94', 'J95-J95', 'J96-J99', 'K00-K14', 'K20-K31', 'K35-K38', 'K40-K46', 'K50-K52', 'K55-K64', 'K65-K68', 'K70-K77', 'K80-K87', 'K90-K95', 'L00-L08', 'L10-L14', 'L20-L30', 'L40-L45', 'L49-L54', 'L55-L59', 'L60-L75', 'L76-L76', 'L80-L99', 'LAXATIVES', 'M00-M02', 'M05-M14', 'M15-M19', 'M1A', 'M20-M25', 'M26-M27', 'M30-M36', 'M40-M43', 'M45-M49', 'M50-M54', 'M60-M63', 'M65-M67', 'M70-M79', 'M80-M85', 'M86-M90', 'M91-M94', 'M96-M96', 'M97-M97', 'M99-M99', 'MIGRAINE PRODUCTS', 'MINERALS & ELECTROLYTES', 'MISCELLANEOUS THERAPEUTIC CLASSES', 'MOUTH/THROAT/DENTAL AGENTS', 'MULTIVITAMINS', 'MUSCULOSKELETAL THERAPY AGENTS', 'N00-N08', 'N10-N16', 'N17-N19', 'N20-N23', 'N25-N29', 'N30-N39', 'N40-N53', 'N60-N65', 'N70-N77', 'N80-N98', 'N99-N99', 'NEUROMUSCULAR AGENTS', 'OPHTHALMIC AGENTS', 'OTIC AGENTS', 'P05-P08', 'P19-P29', 'PROGESTINS', 'PSYCHOTHERAPEUTIC AND NEUROLOGICAL AGENTS - MISC.', 'Q00-Q07', 'Q10-Q18', 'Q20-Q28', 'Q38-Q45', 'Q50-Q56', 'Q60-Q64', 'Q65-Q79', 'Q80-Q89', 'Q90-Q99', 'R00-R09', 'R10-R19', 'R25-R29', 'R30-R39', 'R40-R46', 'R47-R49', 'R50-R69', 'R70-R79', 'R80-R82', 'R83-R89', 'R90-R94', 'R97-R97', 'RESPIRATORY AGENTS - MISC.', 'S00-S09', 'S10-S19', 'S20-S29', 'S30-S39', 'S40-S49', 'S50-S59', 'S60-S69', 'S70-S79', 'S80-S89', 'S90-S99', 'T07-T07', 'T14-T14', 'T15-T19', 'T20-T25', 'T30-T32', 'T51-T65', 'T66-T78', 'T79-T79', 'THYROID AGENTS', 'TOXOIDS', 'U00-U49', 'ULCER DRUGS/ANTISPASMODICS/ANTICHOLINERGICS', 'URINARY ANTI-INFECTIVES', 'URINARY ANTISPASMODICS', 'V00-V09', 'V10-V19', 'V20-V29', 'V40-V49', 'V50-V59', 'V80-V89', 'V98-V99', 'VACCINES', 'VAGINAL AND RELATED PRODUCTS', 'VASOPRESSORS', 'VITAMINS', 'W00-W19', 'W20-W49', 'W50-W64', 'X10-X19', 'X50-X50', 'X52-X58', 'X92-X99', 'Y00-Y09', 'Y70-Y82', 'Y83-Y84', 'Y90-Y99', 'Z00-Z13', 'Z14-Z15', 'Z16-Z16', 'Z17-Z17', 'Z19-Z19', 'Z20-Z29', 'Z55-Z65', 'Z66-Z66', 'Z67-Z67', 'Z69-Z76', 'Z77-Z99']"""
        """(282)1203 = ['id', 'A00-A09', 'A15-A19', 'A20-A28', 'A30-A49', 'A50-A64', 'A65-A69', 'ADHD/ANTI-NARCOLEPSY/ANTI-OBESITY/ANOREXIANTS', 'ALTERNATIVE MEDICINES', 'ANALGESICS - ANTI-INFLAMMATORY', 'ANALGESICS - NonNarcotic', 'ANALGESICS - OPIOID', 'ANDROGENS-ANABOLIC', 'ANORECTAL AND RELATED PRODUCTS', 'ANTACIDS', 'ANTHELMINTICS', 'ANTI-INFECTIVE AGENTS', 'ANTI-INFECTIVE AGENTS - MISC.', 'ANTIANGINAL AGENTS', 'ANTIANXIETY AGENTS', 'ANTIARRHYTHMICS', 'ANTIASTHMATIC AND BRONCHODILATOR AGENTS', 'ANTICOAGULANTS', 'ANTICONVULSANTS', 'ANTIDEPRESSANTS', 'ANTIDIABETICS', 'ANTIDIARRHEAL/PROBIOTIC AGENTS', 'ANTIDOTES AND SPECIFIC ANTAGONISTS', 'ANTIEMETICS', 'ANTIFUNGALS', 'ANTIHISTAMINES', 'ANTIHYPERLIPIDEMICS', 'ANTIHYPERTENSIVES', 'ANTIMALARIALS', 'ANTIMYCOBACTERIAL AGENTS', 'ANTINEOPLASTICS AND ADJUNCTIVE THERAPIES', 'ANTIPARKINSON AND RELATED THERAPY AGENTS', 'ANTIPSYCHOTICS/ANTIMANIC AGENTS', 'ANTISEPTICS & DISINFECTANTS', 'ANTIVIRALS', 'B00-B09', 'B10-B10', 'B15-B19', 'B20-B20', 'B25-B34', 'B35-B49', 'B85-B89', 'B95-B97', 'B99-B99', 'BETA BLOCKERS', 'BMI', 'C00-D49', 'C44-C44', 'CALCIUM CHANNEL BLOCKERS', 'CARDIOTONICS', 'CARDIOVASCULAR AGENTS - MISC.', 'CEPHALOSPORINS', 'CHEMICALS', 'CONTRACEPTIVES', 'CORTICOSTEROIDS', 'COUGH/COLD/ALLERGY', 'D50-D53', 'D55-D59', 'D60-D64', 'D65-D69', 'D70-D77', 'D80-D89', 'DIETARY PRODUCTS/DIETARY MANAGEMENT PRODUCTS', 'DIGESTIVE AIDS', 'DIURETICS', 'E00-E07', 'E08-E13', 'E15-E16', 'E20-E35', 'E40-E46', 'E50-E64', 'E65-E68', 'E70-E88', 'E89-E89', 'ENDOCRINE AND METABOLIC AGENTS - MISC.', 'ESTROGENS', 'F01-F09', 'F10-F19', 'F20-F29', 'F30-F39', 'F40-F48', 'F50-F59', 'F60-F69', 'F70-F79', 'F80-F89', 'F90-F98', 'F99-F99', 'G10-G14', 'G20-G26', 'G30-G32', 'G35-G37', 'G40-G47', 'G50-G59', 'G60-G65', 'G70-G73', 'G80-G83', 'G89-G99', 'GASTROINTESTINAL AGENTS - MISC.', 'GENITOURINARY AGENTS - MISCELLANEOUS', 'GOUT AGENTS', 'H10-H11', 'H15-H22', 'H30-H36', 'H40-H42', 'H43-H44', 'H46-H47', 'H49-H52', 'H53-H54', 'H55-H57', 'H60-H62', 'H65-H75', 'H80-H83', 'H90-H94', 'HEMATOLOGICAL AGENTS - MISC.', 'HEMATOPOIETIC AGENTS', 'HEMOSTATICS', 'HYPNOTICS/SEDATIVES/SLEEP DISORDER AGENTS', 'I00-I02', 'I05-I09', 'I10-I16', 'I20-I25', 'I26-I28', 'I30-I5A', 'I60-I69', 'I70-I79', 'I80-I89', 'I95-I99', 'J00-J06', 'J09-J18', 'J20-J22', 'J30-J39', 'J40-J47', 'J60-J70', 'J80-J84', 'J85-J86', 'J90-J94', 'J95-J95', 'J96-J99', 'K00-K14', 'K20-K31', 'K35-K38', 'K40-K46', 'K50-K52', 'K55-K64', 'K65-K68', 'K70-K77', 'K80-K87', 'K90-K95', 'L00-L08', 'L10-L14', 'L20-L30', 'L40-L45', 'L49-L54', 'L55-L59', 'L60-L75', 'L76-L76', 'L80-L99', 'LAXATIVES', 'M00-M02', 'M05-M1A', 'M15-M19', 'M20-M25', 'M26-M27', 'M30-M36', 'M40-M43', 'M45-M49', 'M50-M54', 'M60-M63', 'M65-M67', 'M70-M79', 'M80-M85', 'M86-M90', 'M91-M94', 'M96-M96', 'M97-M97', 'M99-M99', 'MIGRAINE PRODUCTS', 'MINERALS & ELECTROLYTES', 'MISCELLANEOUS THERAPEUTIC CLASSES', 'MOUTH/THROAT/DENTAL AGENTS', 'MULTIVITAMINS', 'MUSCULOSKELETAL THERAPY AGENTS', 'N00-N08', 'N10-N16', 'N17-N19', 'N20-N23', 'N25-N29', 'N30-N39', 'N40-N53', 'N60-N65', 'N70-N77', 'N80-N98', 'N99-N99', 'NEUROMUSCULAR AGENTS', 'OPHTHALMIC AGENTS', 'OTIC AGENTS', 'P05-P08', 'P19-P29', 'PROGESTINS', 'PSYCHOTHERAPEUTIC AND NEUROLOGICAL AGENTS - MISC.', 'Q00-Q07', 'Q10-Q18', 'Q20-Q28', 'Q38-Q45', 'Q50-Q56', 'Q60-Q64', 'Q65-Q79', 'Q80-Q89', 'Q90-Q99', 'R00-R09', 'R10-R19', 'R25-R29', 'R30-R39', 'R40-R46', 'R47-R49', 'R50-R69', 'R70-R79', 'R80-R82', 'R83-R89', 'R90-R94', 'R97-R97', 'RESPIRATORY AGENTS - MISC.', 'S00-S09', 'S10-S19', 'S20-S29', 'S30-S39', 'S40-S49', 'S50-S59', 'S60-S69', 'S70-S79', 'S80-S89', 'S90-S99', 'T07-T07', 'T14-T14', 'T15-T19', 'T20-T25', 'T30-T32', 'T51-T65', 'T66-T78', 'T79-T79', 'THYROID AGENTS', 'TOXOIDS', 'U00-U85', 'ULCER DRUGS/ANTISPASMODICS/ANTICHOLINERGICS', 'URINARY ANTI-INFECTIVES', 'URINARY ANTISPASMODICS', 'V00-V09', 'V10-V19', 'V20-V29', 'V40-V49', 'V50-V59', 'V80-V89', 'V98-V99', 'VACCINES', 'VAGINAL AND RELATED PRODUCTS', 'VASOPRESSORS', 'VITAMINS', 'W00-W19', 'W20-W49', 'W50-W64', 'X10-X19', 'X50-X50', 'X52-X58', 'X92-Y09', 'Y70-Y82', 'Y83-Y84', 'Y90-Y99', 'Z00-Z13', 'Z14-Z15', 'Z16-Z16', 'Z17-Z17', 'Z19-Z19', 'Z20-Z29', 'Z55-Z65', 'Z66-Z66', 'Z67-Z67', 'Z69-Z76', 'Z77-Z99']"""
        """(282)0523 = ['id', 'A00-A09', 'A15-A19', 'A20-A28', 'A30-A49', 'A50-A64', 'A65-A69', 'ADHD/ANTI-NARCOLEPSY/ANTI-OBESITY/ANOREXIANTS', 'ALTERNATIVE MEDICINES', 'ANALGESICS - ANTI-INFLAMMATORY', 'ANALGESICS - NonNarcotic', 'ANALGESICS - OPIOID', 'ANDROGENS-ANABOLIC', 'ANORECTAL AND RELATED PRODUCTS', 'ANTACIDS', 'ANTHELMINTICS', 'ANTI-INFECTIVE AGENTS', 'ANTI-INFECTIVE AGENTS - MISC.', 'ANTIANGINAL AGENTS', 'ANTIANXIETY AGENTS', 'ANTIARRHYTHMICS', 'ANTIASTHMATIC AND BRONCHODILATOR AGENTS', 'ANTICOAGULANTS', 'ANTICONVULSANTS', 'ANTIDEPRESSANTS', 'ANTIDIABETICS', 'ANTIDIARRHEAL/PROBIOTIC AGENTS', 'ANTIDOTES AND SPECIFIC ANTAGONISTS', 'ANTIEMETICS', 'ANTIFUNGALS', 'ANTIHISTAMINES', 'ANTIHYPERLIPIDEMICS', 'ANTIHYPERTENSIVES', 'ANTIMALARIALS', 'ANTIMYCOBACTERIAL AGENTS', 'ANTINEOPLASTICS AND ADJUNCTIVE THERAPIES', 'ANTIPARKINSON AND RELATED THERAPY AGENTS', 'ANTIPSYCHOTICS/ANTIMANIC AGENTS', 'ANTISEPTICS & DISINFECTANTS', 'ANTIVIRALS', 'B00-B09', 'B10-B10', 'B15-B19', 'B20-B20', 'B25-B34', 'B35-B49', 'B85-B89', 'B95-B97', 'B99-B99', 'BETA BLOCKERS', 'BMI', 'C00-D49', 'C44-C44', 'CALCIUM CHANNEL BLOCKERS', 'CARDIOTONICS', 'CARDIOVASCULAR AGENTS - MISC.', 'CEPHALOSPORINS', 'CHEMICALS', 'CONTRACEPTIVES', 'CORTICOSTEROIDS', 'COUGH/COLD/ALLERGY', 'D50-D53', 'D55-D59', 'D60-D64', 'D65-D69', 'D70-D77', 'D80-D89', 'DIETARY PRODUCTS/DIETARY MANAGEMENT PRODUCTS', 'DIGESTIVE AIDS', 'DIURETICS', 'E00-E07', 'E08-E13', 'E15-E16', 'E20-E35', 'E40-E46', 'E50-E64', 'E65-E68', 'E70-E88', 'E89-E89', 'ENDOCRINE AND METABOLIC AGENTS - MISC.', 'ESTROGENS', 'F01-F09', 'F10-F19', 'F20-F29', 'F30-F39', 'F40-F48', 'F50-F59', 'F60-F69', 'F70-F79', 'F80-F89', 'F90-F98', 'F99-F99', 'G10-G14', 'G20-G26', 'G30-G32', 'G35-G37', 'G40-G47', 'G50-G59', 'G60-G65', 'G70-G73', 'G80-G83', 'G89-G99', 'GASTROINTESTINAL AGENTS - MISC.', 'GENITOURINARY AGENTS - MISCELLANEOUS', 'GOUT AGENTS', 'H10-H11', 'H15-H22', 'H30-H36', 'H40-H42', 'H43-H44', 'H46-H47', 'H49-H52', 'H53-H54', 'H55-H57', 'H60-H62', 'H65-H75', 'H80-H83', 'H90-H94', 'HEMATOLOGICAL AGENTS - MISC.', 'HEMATOPOIETIC AGENTS', 'HEMOSTATICS', 'HYPNOTICS/SEDATIVES/SLEEP DISORDER AGENTS', 'I00-I02', 'I05-I09', 'I10-I16', 'I20-I25', 'I26-I28', 'I30-I5A', 'I60-I69', 'I70-I79', 'I80-I89', 'I95-I99', 'J00-J06', 'J09-J18', 'J20-J22', 'J30-J39', 'J40-J47', 'J60-J70', 'J80-J84', 'J85-J86', 'J90-J94', 'J95-J95', 'J96-J99', 'K00-K14', 'K20-K31', 'K35-K38', 'K40-K46', 'K50-K52', 'K55-K64', 'K65-K68', 'K70-K77', 'K80-K87', 'K90-K95', 'L00-L08', 'L10-L14', 'L20-L30', 'L40-L45', 'L49-L54', 'L55-L59', 'L60-L75', 'L76-L76', 'L80-L99', 'LAXATIVES', 'M00-M02', 'M05-M1A', 'M15-M19', 'M20-M25', 'M26-M27', 'M30-M36', 'M40-M43', 'M45-M49', 'M50-M54', 'M60-M63', 'M65-M67', 'M70-M79', 'M80-M85', 'M86-M90', 'M91-M94', 'M96-M96', 'M97-M97', 'M99-M99', 'MIGRAINE PRODUCTS', 'MINERALS & ELECTROLYTES', 'MISCELLANEOUS THERAPEUTIC CLASSES', 'MOUTH/THROAT/DENTAL AGENTS', 'MULTIVITAMINS', 'MUSCULOSKELETAL THERAPY AGENTS', 'N00-N08', 'N10-N16', 'N17-N19', 'N20-N23', 'N25-N29', 'N30-N39', 'N40-N53', 'N60-N65', 'N70-N77', 'N80-N98', 'N99-N99', 'NEUROMUSCULAR AGENTS', 'OPHTHALMIC AGENTS', 'OTIC AGENTS', 'P05-P08', 'P19-P29', 'PROGESTINS', 'PSYCHOTHERAPEUTIC AND NEUROLOGICAL AGENTS - MISC.', 'Q00-Q07', 'Q10-Q18', 'Q20-Q28', 'Q38-Q45', 'Q50-Q56', 'Q60-Q64', 'Q65-Q79', 'Q80-Q89', 'Q90-Q99', 'R00-R09', 'R10-R19', 'R25-R29', 'R30-R39', 'R40-R46', 'R47-R49', 'R50-R69', 'R70-R79', 'R80-R82', 'R83-R89', 'R90-R94', 'R97-R97', 'RESPIRATORY AGENTS - MISC.', 'S00-S09', 'S10-S19', 'S20-S29', 'S30-S39', 'S40-S49', 'S50-S59', 'S60-S69', 'S70-S79', 'S80-S89', 'S90-S99', 'T07-T07', 'T14-T14', 'T15-T19', 'T20-T25', 'T30-T32', 'T51-T65', 'T66-T78', 'T79-T79', 'THYROID AGENTS', 'TOXOIDS', 'U00-U85', 'ULCER DRUGS/ANTISPASMODICS/ANTICHOLINERGICS', 'URINARY ANTI-INFECTIVES', 'URINARY ANTISPASMODICS', 'V00-V09', 'V10-V19', 'V20-V29', 'V40-V49', 'V50-V59', 'V80-V89', 'V98-V99', 'VACCINES', 'VAGINAL AND RELATED PRODUCTS', 'VASOPRESSORS', 'VITAMINS', 'W00-W19', 'W20-W49', 'W50-W64', 'X10-X19', 'X50-X50', 'X52-X58', 'X92-Y09', 'Y70-Y82', 'Y83-Y84', 'Y90-Y99', 'Z00-Z13', 'Z14-Z15', 'Z16-Z16', 'Z17-Z17', 'Z19-Z19', 'Z20-Z29', 'Z55-Z65', 'Z66-Z66', 'Z67-Z67', 'Z69-Z76', 'Z77-Z99']"""
        """(277)0603 = ['id', 'A00-A09', 'A15-A19', 'A20-A28', 'A30-A49', 'A50-A64', 'A65-A69', 'ADHD/ANTI-NARCOLEPSY/ANTI-OBESITY/ANOREXIANTS', 'ALTERNATIVE MEDICINES', 'ANALGESICS - ANTI-INFLAMMATORY', 'ANALGESICS - NonNarcotic', 'ANALGESICS - OPIOID', 'ANDROGENS-ANABOLIC', 'ANORECTAL AND RELATED PRODUCTS', 'ANTACIDS', 'ANTHELMINTICS', 'ANTI-INFECTIVE DRUGS', 'ANTIANGINAL AGENTS', 'ANTIANXIETY AGENTS', 'ANTIARRHYTHMICS', 'ANTIASTHMATIC AND BRONCHODILATOR AGENTS', 'ANTICOAGULANTS', 'ANTICONVULSANTS', 'ANTIDEPRESSANTS', 'ANTIDIABETICS', 'ANTIDIARRHEAL/PROBIOTIC AGENTS', 'ANTIDOTES AND SPECIFIC ANTAGONISTS', 'ANTIEMETICS', 'ANTIHISTAMINES', 'ANTIHYPERLIPIDEMICS', 'ANTIHYPERTENSIVES', 'ANTIMALARIALS', 'ANTINEOPLASTICS AND ADJUNCTIVE THERAPIES', 'ANTIPARKINSON AND RELATED THERAPY AGENTS', 'ANTIPSYCHOTICS/ANTIMANIC AGENTS', 'ANTISEPTICS & DISINFECTANTS', 'B00-B09', 'B10-B10', 'B15-B19', 'B20-B20', 'B25-B34', 'B35-B49', 'B85-B89', 'B95-B97', 'B99-B99', 'BETA BLOCKERS', 'BMI', 'C00-D49', 'C44-C44', 'CALCIUM CHANNEL BLOCKERS', 'CARDIOTONICS', 'CARDIOVASCULAR AGENTS - MISC.', 'CHEMICALS', 'CONTRACEPTIVES', 'CORTICOSTEROIDS', 'COUGH/COLD/ALLERGY', 'D50-D53', 'D55-D59', 'D60-D64', 'D65-D69', 'D70-D77', 'D80-D89', 'DIETARY PRODUCTS/DIETARY MANAGEMENT PRODUCTS', 'DIGESTIVE AIDS', 'DIURETICS', 'E00-E07', 'E08-E13', 'E15-E16', 'E20-E35', 'E40-E46', 'E50-E64', 'E65-E68', 'E70-E88', 'E89-E89', 'ENDOCRINE AND METABOLIC AGENTS - MISC.', 'ESTROGENS', 'F01-F09', 'F10-F19', 'F20-F29', 'F30-F39', 'F40-F48', 'F50-F59', 'F60-F69', 'F70-F79', 'F80-F89', 'F90-F98', 'F99-F99', 'G10-G14', 'G20-G26', 'G30-G32', 'G35-G37', 'G40-G47', 'G50-G59', 'G60-G65', 'G70-G73', 'G80-G83', 'G89-G99', 'GASTROINTESTINAL AGENTS - MISC.', 'GENITOURINARY AGENTS - MISCELLANEOUS', 'GOUT AGENTS', 'H10-H11', 'H15-H22', 'H30-H36', 'H40-H42', 'H43-H44', 'H46-H47', 'H49-H52', 'H53-H54', 'H55-H57', 'H60-H62', 'H65-H75', 'H80-H83', 'H90-H94', 'HEMATOLOGICAL AGENTS - MISC.', 'HEMATOPOIETIC AGENTS', 'HEMOSTATICS', 'HYPNOTICS/SEDATIVES/SLEEP DISORDER AGENTS', 'I00-I02', 'I05-I09', 'I10-I16', 'I20-I25', 'I26-I28', 'I30-I5A', 'I60-I69', 'I70-I79', 'I80-I89', 'I95-I99', 'J00-J06', 'J09-J18', 'J20-J22', 'J30-J39', 'J40-J47', 'J60-J70', 'J80-J84', 'J85-J86', 'J90-J94', 'J95-J95', 'J96-J99', 'K00-K14', 'K20-K31', 'K35-K38', 'K40-K46', 'K50-K52', 'K55-K64', 'K65-K68', 'K70-K77', 'K80-K87', 'K90-K95', 'L00-L08', 'L10-L14', 'L20-L30', 'L40-L45', 'L49-L54', 'L55-L59', 'L60-L75', 'L76-L76', 'L80-L99', 'LAXATIVES', 'M00-M02', 'M05-M1A', 'M15-M19', 'M20-M25', 'M26-M27', 'M30-M36', 'M40-M43', 'M45-M49', 'M50-M54', 'M60-M63', 'M65-M67', 'M70-M79', 'M80-M85', 'M86-M90', 'M91-M94', 'M96-M96', 'M97-M97', 'M99-M99', 'MIGRAINE PRODUCTS', 'MINERALS & ELECTROLYTES', 'MISCELLANEOUS THERAPEUTIC CLASSES', 'MOUTH/THROAT/DENTAL AGENTS', 'MULTIVITAMINS', 'MUSCULOSKELETAL THERAPY AGENTS', 'N00-N08', 'N10-N16', 'N17-N19', 'N20-N23', 'N25-N29', 'N30-N39', 'N40-N53', 'N60-N65', 'N70-N77', 'N80-N98', 'N99-N99', 'NEUROMUSCULAR AGENTS', 'OPHTHALMIC AGENTS', 'OTIC AGENTS', 'P05-P08', 'P19-P29', 'PROGESTINS', 'PSYCHOTHERAPEUTIC AND NEUROLOGICAL AGENTS - MISC.', 'Q00-Q07', 'Q10-Q18', 'Q20-Q28', 'Q38-Q45', 'Q50-Q56', 'Q60-Q64', 'Q65-Q79', 'Q80-Q89', 'Q90-Q99', 'R00-R09', 'R10-R19', 'R25-R29', 'R30-R39', 'R40-R46', 'R47-R49', 'R50-R69', 'R70-R79', 'R80-R82', 'R83-R89', 'R90-R94', 'R97-R97', 'RESPIRATORY AGENTS - MISC.', 'S00-S09', 'S10-S19', 'S20-S29', 'S30-S39', 'S40-S49', 'S50-S59', 'S60-S69', 'S70-S79', 'S80-S89', 'S90-S99', 'T07-T07', 'T14-T14', 'T15-T19', 'T20-T25', 'T30-T32', 'T51-T65', 'T66-T78', 'T79-T79', 'THYROID AGENTS', 'TOXOIDS', 'U00-U85', 'ULCER DRUGS/ANTISPASMODICS/ANTICHOLINERGICS', 'URINARY ANTI-INFECTIVES', 'URINARY ANTISPASMODICS', 'V00-V09', 'V10-V19', 'V20-V29', 'V40-V49', 'V50-V59', 'V80-V89', 'V98-V99', 'VACCINES', 'VAGINAL AND RELATED PRODUCTS', 'VASOPRESSORS', 'VITAMINS', 'W00-W19', 'W20-W49', 'W50-W64', 'X10-X19', 'X50-X50', 'X52-X58', 'X92-Y09', 'Y70-Y82', 'Y83-Y84', 'Y90-Y99', 'Z00-Z13', 'Z14-Z15', 'Z16-Z16', 'Z17-Z17', 'Z19-Z19', 'Z20-Z29', 'Z55-Z65', 'Z66-Z66', 'Z67-Z67', 'Z69-Z76', 'Z77-Z99']"""

# load test records

test_records = {}
with open(root_path + 'data_20220523_rebuild_1304/yellow_loinc_personal_digital_20220523.csv', newline='') as csvfile:  # loinc tests not change
    spamreader = csv.reader(csvfile, delimiter=',')
    for i, row in enumerate(spamreader):
        if i == 0:
            print(row)
            """0603 = ['id', '25-hydroxyvitamin D', 'Alanine aminotransferase', 'Albumin blood', 'Alkaline phosphatase total', 'Anion gap', 'Aspartate amino transferase', 'Basophil', 'Bilirubin.direct [Mass/volume] in Serum or Plasma', 'Bilirubin.total [Mass/volume] in Serum or Plasma', 'Bilirubin.total [Mass/volume] in Urine', 'Bilirubin.total [Presence] in Urine by Test strip', 'C-reactive protein', 'Calcium ionized', 'Calcium total blood', 'Chloride', 'Creatine kinase [Enzymatic activity/volume] in Serum or Plasma', 'ESR', 'Erythrocytes [Presence] in Urine', 'Free T4', 'GFR', 'HCG presence urine', 'HCV Antibody', 'HDL', 'HGBA1c', 'HIV antibody', 'Hematocrit', 'Hepatitis B virus surface Ag [Presence] in Serum', 'INR', 'Indirect antiglobulin test.complement specific reagent [Presence] in Serum or Plasma', 'Iron [Mass/volume] in Serum or Plasma', 'Iron binding capacity [Mass/volume] in Serum or Plasma', 'Iron binding capacity.unsaturated [Mass/volume] in Serum or Plasma', 'Iron saturation [Mass Fraction] in Serum or Plasma', 'LDL', 'Leukocytes ', 'Leukocytes [#/volume] in Urine', 'Lipase [Enzymatic activity/volume] in Serum or Plasma', 'Lymphocytes', 'MCH [Entitic mass] by Automated count', 'MCHC [Mass/volume] by Automated count', 'MCV', 'Magnesium', 'Neutrophils', 'Nitrite [Presence] in Urine by Test strip', 'P-R Interval', 'PT', 'PTH ', 'Phosphate [Mass/volume] in Serum or Plasma', 'Protein serum', 'Q-T interval corrected', 'QRS duration', 'RBC', 'RDW', 'SARS coronavirus 2', 'Sodium  blood', 'Specific gravity of Urine by Test strip', 'TSH', 'Total cholesterol', 'Total cholesterol/HDL ratio', 'Triglyceride [Mass/volume] in Serum or Plasma', 'Troponin I.cardiac [Mass/volume] in Serum or Plasma', 'Urate [Mass/volume] in Serum or Plasma', 'Urea nitrogen [Mass/volume] in Blood', 'Urea nitrogen [Mass/volume] in Serum or Plasma', 'Urobilinogen [Mass/volume] in Urine', 'Urobilinogen [Units/volume] in Urine by Test strip', 'aPTT', 'carbon dioxide mmol/L', 'chloride', 'creatinine blood', 'creatinine clearance', 'creatinine urine random', 'eosinophils', 'ferritin', 'glucose', 'hemoglobin', 'ketones urine', 'monocytes', 'non-HDL', 'pH of Urine by Test strip', 'platelets', 'potassium', 'protein mass/volume urine by test strip', 'protein urine presense test strip']"""
            """1105 = ['id', '25-hydroxyvitamin D', 'Alanine aminotransferase', 'Albumin blood', 'Alkaline phosphatase total', 'Anion gap', 'Aspartate amino transferase', 'Basophil', 'Bilirubin.direct [Mass/volume] in Serum or Plasma', 'Bilirubin.total [Mass/volume] in Serum or Plasma', 'Bilirubin.total [Mass/volume] in Urine', 'Bilirubin.total [Presence] in Urine by Test strip', 'C-reactive protein', 'Calcium ionized', 'Calcium total blood', 'Chloride', 'Creatine kinase [Enzymatic activity/volume] in Serum or Plasma', 'ESR', 'Erythrocytes [Presence] in Urine', 'Free T4', 'GFR', 'HCG presence urine', 'HCV Antibody', 'HDL', 'HGBA1c', 'HIV antibody', 'Hepatitis B virus surface Ag [Presence] in Serum', 'INR', 'Indirect antiglobulin test.complement specific reagent [Presence] in Serum or Plasma', 'Iron [Mass/volume] in Serum or Plasma', 'Iron binding capacity [Mass/volume] in Serum or Plasma', 'Iron binding capacity.unsaturated [Mass/volume] in Serum or Plasma', 'Iron saturation [Mass Fraction] in Serum or Plasma', 'LDL', 'Leukocytes ', 'Leukocytes [#/volume] in Urine', 'Lipase [Enzymatic activity/volume] in Serum or Plasma', 'Lymphocytes', 'Magnesium', 'Neutrophils', 'Nitrite [Presence] in Urine by Test strip', 'P-R Interval', 'PT', 'PTH ', 'Phosphate [Mass/volume] in Serum or Plasma', 'Protein serum', 'Q-T interval corrected', 'QRS duration', 'SARS coronavirus 2', 'Sodium  blood', 'Specific gravity of Urine by Test strip', 'TSH', 'Total cholesterol', 'Total cholesterol/HDL ratio', 'Triglyceride [Mass/volume] in Serum or Plasma', 'Troponin I.cardiac [Mass/volume] in Serum or Plasma', 'Urate [Mass/volume] in Serum or Plasma', 'Urea nitrogen [Mass/volume] in Blood', 'Urea nitrogen [Mass/volume] in Serum or Plasma', 'Urobilinogen [Mass/volume] in Urine', 'Urobilinogen [Units/volume] in Urine by Test strip', 'aPTT', 'carbon dioxide mmol/L', 'chloride', 'creatinine blood', 'eosinophils', 'ferritin', 'glucose', 'hemoglobin', 'ketones urine', 'monocytes', 'non-HDL', 'pH of Urine by Test strip', 'platelets', 'potassium', 'protein mass/volume urine by test strip', 'protein urine presense test strip']"""
            """1119 = ['id', '25-hydroxyvitamin D', 'Alanine aminotransferase', 'Albumin blood', 'Alkaline phosphatase total', 'Anion gap', 'Aspartate amino transferase', 'Basophil', 'Bilirubin.direct [Mass/volume] in Serum or Plasma', 'Bilirubin.total [Mass/volume] in Serum or Plasma', 'Bilirubin.total [Mass/volume] in Urine', 'Bilirubin.total [Presence] in Urine by Test strip', 'C-reactive protein', 'Calcium ionized', 'Calcium total blood', 'Chloride', 'Creatine kinase [Enzymatic activity/volume] in Serum or Plasma', 'ESR', 'Erythrocytes [Presence] in Urine', 'Free T4', 'GFR', 'HCG presence urine', 'HCV Antibody', 'HDL', 'HGBA1c', 'HIV antibody', 'Hepatitis B virus surface Ag [Presence] in Serum', 'INR', 'Indirect antiglobulin test.complement specific reagent [Presence] in Serum or Plasma', 'Iron [Mass/volume] in Serum or Plasma', 'Iron binding capacity.unsaturated [Mass/volume] in Serum or Plasma', 'Iron saturation [Mass Fraction] in Serum or Plasma', 'LDL', 'Leukocytes ', 'Leukocytes [#/volume] in Urine', 'Lipase [Enzymatic activity/volume] in Serum or Plasma', 'Lymphocytes', 'Magnesium', 'Neutrophils', 'Nitrite [Presence] in Urine by Test strip', 'PTH ', 'Phosphate [Mass/volume] in Serum or Plasma', 'Protein serum', 'Q-T interval corrected', 'QRS duration', 'SARS coronavirus 2', 'Sodium  blood', 'TSH', 'Total cholesterol', 'Triglyceride [Mass/volume] in Serum or Plasma', 'Troponin I.cardiac [Mass/volume] in Serum or Plasma', 'Urate [Mass/volume] in Serum or Plasma', 'Urobilinogen [Mass/volume] in Urine', 'Urobilinogen [Units/volume] in Urine by Test strip', 'aPTT', 'carbon dioxide mmol/L', 'chloride', 'eosinophils', 'ferritin', 'glucose', 'hemoglobin', 'ketones urine', 'monocytes', 'non-HDL', 'platelets', 'potassium', 'protein mass/volume urine by test strip', 'protein urine presense test strip']"""
            """0523 = ['id', '25-hydroxyvitamin D', 'Alanine aminotransferase', 'Albumin blood', 'Alkaline phosphatase total', 'Anion gap', 'Aspartate amino transferase', 'Basophil', 'Bilirubin.direct [Mass/volume] in Serum or Plasma', 'Bilirubin.total [Mass/volume] in Serum or Plasma', 'Bilirubin.total [Mass/volume] in Urine', 'Bilirubin.total [Presence] in Urine by Test strip', 'C-reactive protein', 'Calcium ionized', 'Calcium total blood', 'Chloride', 'Creatine kinase [Enzymatic activity/volume] in Serum or Plasma', 'ESR', 'Erythrocytes [Presence] in Urine', 'Free T4', 'GFR', 'HCG presence urine', 'HCV Antibody', 'HDL', 'HGBA1c', 'HIV antibody', 'Hepatitis B virus surface Ag [Presence] in Serum', 'INR', 'Indirect antiglobulin test.complement specific reagent [Presence] in Serum or Plasma', 'Iron [Mass/volume] in Serum or Plasma', 'Iron binding capacity.unsaturated [Mass/volume] in Serum or Plasma', 'Iron saturation [Mass Fraction] in Serum or Plasma', 'LDL', 'Leukocytes ', 'Leukocytes [#/volume] in Urine', 'Lipase [Enzymatic activity/volume] in Serum or Plasma', 'Lymphocytes', 'Magnesium', 'Neutrophils', 'Nitrite [Presence] in Urine by Test strip', 'PTH ', 'Phosphate [Mass/volume] in Serum or Plasma', 'Protein serum', 'Q-T interval corrected', 'QRS duration', 'SARS coronavirus 2', 'Sodium  blood', 'TSH', 'Total cholesterol', 'Triglyceride [Mass/volume] in Serum or Plasma', 'Troponin I.cardiac [Mass/volume] in Serum or Plasma', 'Urate [Mass/volume] in Serum or Plasma', 'Urobilinogen [Mass/volume] in Urine', 'Urobilinogen [Units/volume] in Urine by Test strip', 'aPTT', 'carbon dioxide mmol/L', 'chloride', 'eosinophils', 'ferritin', 'glucose', 'hemoglobin', 'ketones urine', 'monocytes', 'non-HDL', 'platelets', 'potassium', 'protein mass/volume urine by test strip', 'protein urine presense test strip']"""
            test_features_len = len(row[1:])
            print(test_features_len, test_features_len+pharmacy_features_len)
            # 0603=(84 378), 1105=(76 369), 1119=(67 351);0523=67 349; 0603=(67 344)
        if not row:
            continue
        test_records[row[0]] = row[1:]


w21 = csv.writer(open(root_path + 'data_20220603_1304/id_label_bi_20220603_digital_1304.csv', "a"))

all_features = []
patient_frequency = []

# load disease labels

with open(root_path + 'data_1026/demographics.csv', newline='') as csvfile0:
    spamreader0 = csv.reader(csvfile0, delimiter=',')

    for i, row in enumerate(spamreader0):
        if i == 0:
            print(row)  # ['STUDY_ID', 'DATEOFSTUDY', 'DOB', 'AGE', 'GENDER', 'RACE', 'ETHNICITY', 'HEIGHT', 'WEIGHT', 'BMI', 'PROSTHESIS', 'PROSTHESISPLEASESPECIFY', 'ORTHOSIS', 'ORTHOSIS_PLEASESPECIFY_', 'COMMENTS', 'BESTGRIPSTRENGTH', 'TIMEFOR5CHAIRSTANDS', 'NORLANDAPPENDICULARLEAN', 'USUALGAITSPEED', 'TOTALSPPBSCORE']
        elif i:
            # patient info
            id = row[0]  # read id
            age = float(row[3])
            gender = row[4]

            # disease or not
            d = 0
            for j in range(5):
                d += int(row[-j - 1])  # if any one in the last 5 cols be 1， the label will be 1
            if d > 0:
                d = 1

            # save features to a dict
            pharmacy_dict = {}

            # check comb record
            drop = 0
            if id in pharmacy_records.keys():
                local_pharmacy_record = pharmacy_records[id]
            else:
                local_pharmacy_record = [0] * pharmacy_features_len
                drop += 1
            if id in test_records.keys():
                local_test_record = test_records[id]
            else:
                local_test_record = [0] * test_features_len
                drop += 1

            if drop == 2:
                drop_patient += 1
                continue

            # tf score features
            # w20.writerow([d] + local_pharmacy_record + local_test_record)

            # binary score features
            binary_string = []
            binary_number = []
            for item in local_pharmacy_record:
                if item == '0':
                    binary_string.append(item)
                    binary_number.append(0)
                else:
                    binary_string.append('1')
                    binary_number.append(1)

            w21.writerow([d] + binary_string + local_test_record)

# print(len(patient_frequency[0]))
# print(len(patient_frequency))
# patient_frequecy = np.sum(patient_frequency, axis=0)
# print(len(patient_frequecy))
# print(patient_frequecy)
print('drop patient', drop)  # 0
